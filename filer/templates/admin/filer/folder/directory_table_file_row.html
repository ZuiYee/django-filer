{% load i18n l10n admin_list filer_tags filer_admin_tags staticfiles drafts_admin_tags %}

{% with item as file %}
    {% filer_has_permission item 'edit' as has_change_permission %}
    <tr>
        <td class="column-checkbox">
            {% if is_popup and filer_admin_context.pick_file and not file.is_draft %}
                <a class="insertlink insertlinkButton" href="#" onclick="opener.dismissRelatedImageLookupPopup(window, {{ file.id|unlocalize }}, '{{ file.icons.48|escapejs }}', '{{ file.label|escapejs }}'); return false;"
                    title="{% trans 'Select this file' %}">&nbsp;</a>
            {% elif action_form and not is_popup %}
                <input type="checkbox" class="action-select" value="file-{{ item.pk }}" name="_selected_action">
            {% endif %}
        </td>
        <td class="column-icon">
            {% if is_popup and filer_admin_context.pick_file and not file.is_draft %}
                <a href="#" onclick="opener.dismissRelatedImageLookupPopup(window, {{ file.id|unlocalize }}, '{{ file.icons.48|escapejs }}', '{{ file.label|escapejs }}'); return false;"
                    title="{% trans 'Select this file' %}">
            {% elif is_popup and filer_admin_context.pick_file and file.is_draft %}
                {# Don't link if this is a draft #}
            {% elif has_change_permission %}
                <a href="{{ file.get_admin_change_url }}{% filer_admin_context_url_params %}"
                        title="{% blocktrans with file.label as item_label %}Change '{{ item_label }}' details{% endblocktrans %}">
            {% endif %}
                <img src="{% if file.icons.48 %}{{ file.icons.48 }}{% else %}{% static 'filer/icons/missingfile_48x48.png' %}{% endif %}" alt="{{ file.default_alt_text }}" width="28" height="28">
            {% if is_popup and filer_admin_context.pick_file and file.is_draft %}
                {# Don't link if this is a draft #}
            {% elif has_change_permission or is_popup and filer_admin_context.pick_file %}
                </a>
            {% endif %}
        </td>
        <td class="column-name">
            <div>
                <strong>
                    {% if is_popup and filer_admin_context.pick_file and not file.is_draft %}
                        <a href="#" onclick="opener.dismissRelatedImageLookupPopup(window, {{ file.id|unlocalize }}, '{{ file.icons.48|escapejs }}', '{{ file.label|escapejs }}'); return false;"
                            title="{% trans 'Select this file' %}">
                    {% elif is_popup and filer_admin_context.pick_file and file.is_draft %}
                        {# Don't link if this is a draft #}
                    {% elif has_change_permission %}
                        <a href="{{ file.get_admin_change_url }}{% filer_admin_context_url_params %}"
                            title="{% blocktrans with file.label as item_label %}Change '{{ item_label }}' details{% endblocktrans %}">
                    {% endif %}
                    {{ file.label }}
                    {% if is_popup and filer_admin_context.pick_file and file.is_draft %}
                        {# Don't link if this is a draft #}
                    {% elif has_change_permission or is_popup and filer_admin_context.pick_file %}
                        </a>
                    {% endif %}
                    {% if is_popup and filer_admin_context.pick_file and file.is_live and file.has_pending_changes %}
                        <a
                            class="insertlink insertlinkButton"
                            style="float: right;"
                            href="#"
                            onclick="opener.dismissRelatedImageLookupPopup(window, {{ file.draft.id|unlocalize }}, '{{ file.draft.icons.48|escapejs }}', '{{ file.draft.label|escapejs }}'); return false;"
                            title="{% trans 'Select this file' %}"
                        >{% trans "pick" %} {% include 'admin/filer/includes/draft-indicator.html' %}</a>
                    {% elif is_popup and filer_admin_context.pick_file and file.is_draft %}
                        <a
                            class="insertlink insertlinkButton"
                            style="float: right;"
                            href="#"
                            onclick="opener.dismissRelatedImageLookupPopup(window, {{ file.id|unlocalize }}, '{{ file.icons.48|escapejs }}', '{{ file.label|escapejs|escapejs }}'); return false;"
                            title="{% trans 'Select this file' %}"
                        >{% trans "pick" %} {% include 'admin/filer/includes/draft-indicator.html' %}</a>
                    {% elif file.is_live and file.has_pending_changes and not is_popup %}
                        <a style="display: block; float: right;" href="{{ file.draft.get_admin_change_url }}">{% trans "has pending changes" %}&nbsp;{% include 'admin/filer/includes/draft-indicator.html' %}</a>
                    {% elif file.is_draft and not is_popup %}
                        <a style="display: block; float: right;" href="{{ file.get_admin_change_url }}">{% include 'admin/filer/includes/draft-indicator.html' %}</a>
                    {% endif %}
                </strong>
            </div>
            {% if enable_permissions %}
                <div>{% trans "Permissions" %}: {% if file.is_public %}{% trans "disabled" %}{% else %}{% trans "enabled" %}{% endif %}</div>
            {% endif %}
        </td>
        <td class="column-owner">
            {{ file.owner|default:"n/a" }}
        </td>
        <td class="column-size">
            <span class="tiny"> ({{ file.size|filesize:"auto1000long" }}{% ifequal file.file_type "Image" %}, {{ file.width }}x{{ file.height }} px{% endifequal %})</span>
        </td>
        <td class="column-action">
            <a href="{{ file.canonical_url }}"
                title="{% blocktrans with file.label as item_label %}Canonical url '{{ item_label }}'{% endblocktrans %}" class="action-button" target="_blank"><span class="fa fa-link"></span></a>
            <a href="{{ file.url }}" target="_blank"
                title="{% blocktrans with file.label as item_label %}Download '{{ item_label }}'{% endblocktrans %}" class="action-button"><span class="fa fa-download"></span></a>
            <a href="{{ file.get_admin_change_url }}{% filer_admin_context_url_params %}"
                title="{% blocktrans with file.label as item_label %}Change '{{ item_label }}' details{% endblocktrans %}" class="action-button"><span class="fa fa-pencil"></span></a>
            <a href="{{ file.get_admin_delete_url }}{% filer_admin_context_url_params %}" title="{% trans 'Remove file' %}" class="action-button"><span class="fa fa-trash"></span></a>
        </td>
    </tr>
{% endwith %}
